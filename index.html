<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A bill-splitting calculator that helps couples and housemates divide expenses fairly based on their income.">
    <title>FairShare - Fair Bill Splitting Calculator</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preload" href="logo.svg" as="image">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=optional" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=optional"></noscript>
</head>
<body>

<div class="lazy-loader">
    <div class="spinner"></div>
</div>

<div id="offline-indicator" class="alert alert--info alert--fixed-top" hidden aria-live="polite">
    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-offline.svg'); mask-image: url('icons/icon-offline.svg');" aria-hidden="true"></span>
    <div class="alert__text">Working Offline</div>
</div>

<a href="#main-content" class="skip-link">Skip to main content</a>

<main id="main-content">
    <div class="app-container">
        <header class="header-brand" id="header-brand">
            <img src="logo.svg" alt="FairShare - Salary Proportion Calculator" width="280" height="70">
            <button id="start-over-button" onclick="clearCacheAndReload()" aria-label="Start over and clear all data">
                Start Over
            </button>
        </header>

        <section class="screen" id="screen-1" aria-labelledby="heading-landing" tabindex="-1">
            <h2 id="heading-landing">
                <img src="icons/icon-heart.svg" alt="Welcome Icon">
                Welcome to FairShare
            </h2>

            <div class="landing-intro" id="landing-intro">
                <p>
                    <strong>Build a fair financial foundation for your home.</strong><br>
                    Establish proportionate bill splitting based on your relative incomes in just 7 steps.
                </p>
                <div id="efficiency-tip" class="alert alert--info">
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-info.svg'); mask-image: url('icons/icon-info.svg');" aria-hidden="true"></span>
                    <div class="alert__text">
                        <strong>Efficiency Tip:</strong> Use your <strong>Arrow Keys</strong> or <strong>Enter</strong> to navigate quickly between screens.
                    </div>
                </div>
                <p class="screen-summary">
                    This guide automates your household budgeting. By establishing a contribution ratio, you'll ensure both partners retain a fair share of disposable income, removing financial friction before it starts.
                </p>
            </div>

            <div class="how-it-works" id="how-it-works">
                <h3>Rapid Overview:</h3>
                <ol>
                    <li>Set your income-based contribution ratio.</li>
                    <li>Estimate property value and regional running costs.</li>
                    <li>Review your detailed proportionate split report.</li>
                </ol>
            </div>
        </section>

        <section class="screen" id="screen-2" aria-labelledby="heading-income" tabindex="-1" hidden>
            <h2 id="heading-income">
                <img src="icons/icon-money.svg" alt="Income Icon">
                Your Income
            </h2>
            <p>Establish your base contribution ratio.</p>
            <p class="screen-summary">
                Provide your annual pre-tax salaries to calculate your unique contribution percentage. This ensures all shared bills are split proportionately to each partner's individual earning power.
            </p>

            <div class="form-group">
                <label class="form-label" for="salaryP1">Your Annual Salary (Pre-tax)</label>
                <div class="input-group">
                    <span class="input-group__addon">£</span>
                    <input type="number" id="salaryP1" class="input-group__control" required aria-required="true" placeholder="e.g. 35000" aria-describedby="salaryP1-help salaryP1-error" data-cy="salaryP1-input">
                </div>
                <div id="salaryP1-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter a valid annual salary.</div>
                </div>
                <div id="salaryP1-help" class="help-text">Your combined income determines your individual percentage of the household bills.</div>
            </div>

            <div class="form-group">
                <label class="form-label" for="salaryP2">Your Partner's Annual Salary (Pre-tax)</label>
                <div class="input-group">
                    <span class="input-group__addon">£</span>
                    <input type="number" id="salaryP2" class="input-group__control" required aria-required="true" placeholder="e.g. 45000" aria-describedby="salaryP2-help salaryP2-error" data-cy="salaryP2-input">
                </div>
                <div id="salaryP2-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter a valid annual salary for your partner.</div>
                </div>
                <div id="salaryP2-help" class="help-text">Your combined income determines your individual percentage of the household bills.</div>
            </div>
        </section>

        <section class="screen" id="screen-3" aria-labelledby="heading-property" tabindex="-1" hidden>
            <h2 id="heading-property">
                <img src="icons/icon-building.svg" alt="Property Icon">
                Property Details
            </h2>
            <p>Define your home to automate cost estimates.</p>
            <p class="screen-summary">
                Enter your postcode and property size. We use regional data to automate accurate estimates for Council Tax and local utility rates based on your specific location.
            </p>

            <div class="form-group">
                <label class="form-label" for="postcode">Property Postcode</label>
                <div class="input-group">
                    <input type="text" id="postcode" class="input-group__control" aria-describedby="postcode-help postcode-error" onblur="checkRegion()" placeholder="e.g. SW1A 0AA" data-cy="postcode-input">
                </div>
                <div id="postcode-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter a valid UK postcode.</div>
                </div>
                <div id="postcode-help" class="help-text">Used to estimate local market prices and regional utility variations.</div>
                <div id="region-announcement" class="alert alert--info" aria-live="polite" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-info.svg'); mask-image: url('icons/icon-info.svg');" aria-hidden="true"></span>
                    <div class="alert__text"></div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="propertyPrice">Current Market Value (£)</label>
                <div class="input-group">
                    <span class="input-group__addon">£</span>
                    <input type="number" id="propertyPrice" class="input-group__control" placeholder="e.g. 250000" aria-describedby="propertyPrice-error" data-cy="propertyPrice-input">
                    <button type="button" id="estimatePriceBtn" class="btn-addon" data-cy="estimatePrice-button">Estimate</button>
                </div>
                <div id="propertyPrice-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter a property value or use a postcode to estimate.</div>
                </div>
                <div id="propertyPrice-estimate-display" aria-live="polite" class="help-text" hidden>
                    Using estimated market price: <span id="estimatedPriceValue" class="fw-bold"></span>
                </div>
            </div>

            <fieldset class="form-group" data-cy="taxBand-fieldset">
                <legend class="form-label">Select Valuation Band</legend>
                <p class="help-text">Council Tax is determined by the property's assigned valuation band.</p>
                <a href="https://www.gov.uk/council-tax-bands" target="_blank" rel="nofollow" class="btn btn-external">
                    Find your Council Tax Band
                    <span class="icon-btn" style="-webkit-mask-image: url('icons/icon-external-link.svg'); mask-image: url('icons/icon-external-link.svg');" aria-hidden="true"></span>
                </a>
                <div class="segmented-control">
                    <input type="radio" name="taxBand" id="bA" value="A" onchange="updatePricePreview('A')" class="segmented-control__input">
                    <label for="bA" class="segmented-control__label">A</label>
                    
                    <input type="radio" name="taxBand" id="bB" value="B" onchange="updatePricePreview('B')" class="segmented-control__input">
                    <label for="bB" class="segmented-control__label">B</label>
                    
                    <input type="radio" name="taxBand" id="bC" value="C" onchange="updatePricePreview('C')" class="segmented-control__input">
                    <label for="bC" class="segmented-control__label">C</label>
                    
                    <input type="radio" name="taxBand" id="bD" value="D" onchange="updatePricePreview('D')" class="segmented-control__input">
                    <label for="bD" class="segmented-control__label">D</label>
                    
                    <input type="radio" name="taxBand" id="bE" value="E" onchange="updatePricePreview('E')" class="segmented-control__input">
                    <label for="bE" class="segmented-control__label">E</label>
                    
                    <input type="radio" name="taxBand" id="bF" value="F" onchange="updatePricePreview('F')" class="segmented-control__input">
                    <label for="bF" class="segmented-control__label">F</label>
                    
                    <input type="radio" name="taxBand" id="bG" value="G" onchange="updatePricePreview('G')" class="segmented-control__input">
                    <label for="bG" class="segmented-control__label">G</label>
                    
                    <input type="radio" name="taxBand" id="bH" value="H" onchange="updatePricePreview('H')" class="segmented-control__input">
                    <label for="bH" class="segmented-control__label">H</label>
                </div>
                <div id="taxBand-error" class="alert alert--error" aria-live="assertive" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please select a valuation band to continue.</div>
                </div>
            </fieldset>

            <div id="band-price-display" class="alert alert--info" aria-live="polite">
                <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-info.svg'); mask-image: url('icons/icon-info.svg');" aria-hidden="true"></span>
                <div class="alert__text">Select a band to see estimated cost</div>
            </div>

            <div class="form-row">
                <div class="form-group col">
                    <label class="form-label" for="bedrooms">Bedrooms</label>
                    <div class="input-group">
                        <input type="number" id="bedrooms" class="input-group__control" value="2" min="1" max="50" required aria-describedby="bedrooms-error" data-cy="bedrooms-input">
                    </div>
                    <div id="bedrooms-error" class="alert alert--error" hidden>
                        <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                        <div class="alert__text">Required.</div>
                    </div>
                </div>
                <div class="form-group col">
                    <label class="form-label" for="bathrooms">Bathrooms</label>
                    <div class="input-group">
                        <input type="number" id="bathrooms" class="input-group__control" value="1" min="1" max="50" required aria-describedby="bathrooms-error" data-cy="bathrooms-input">
                    </div>
                    <div id="bathrooms-error" class="alert alert--error" hidden>
                        <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                        <div class="alert__text">Required.</div>
                    </div>
                </div>
            </div>

            <div id="warning-screen-3" class="alert alert--warning" role="alert" aria-live="polite" hidden>
                <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                <div class="alert__text"></div>
            </div>
        </section>

        <section class="screen" id="screen-4" aria-labelledby="heading-mortgage" tabindex="-1" hidden>
            <h2 id="heading-mortgage">
                <img src="icons/icon-money.svg" alt="Mortgage Icon">
                Mortgage & Equity
            </h2>

            <p>Finalize home ownership and financing details.</p>
            <p class="screen-summary">
                Set your deposit and interest rates. We calculate monthly repayments and individual equity shares to ensure your largest joint commitment is split fairly and transparently.
            </p>

            <!-- 1. Context: Loan & Deposit -->
            <div class="form-group">
                <label class="form-label" for="depositPercentage">Total Deposit Percentage (%)</label>
                <div class="input-group">
                    <input type="number" id="depositPercentage" class="input-group__control" value="10" min="0" max="100" required aria-describedby="depositPercentage-help depositPercentage-error" data-cy="depositPercentage-input">
                    <span class="input-group__addon">%</span>
                </div>
                <div id="depositPercentage-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter a deposit percentage (0-100).</div>
                </div>
                <div id="depositPercentage-help" class="help-text">The total cash deposit you are both putting down combined.</div>
            </div>

            <fieldset class="form-group">
                <legend class="form-label">Split Deposit Proportionally?</legend>
                <div class="toggle">
                    <input type="radio" name="depositSplitType" id="splitPropYes" value="yes" checked class="toggle__input">
                    <label for="splitPropYes" class="toggle__label">Income Ratio</label>
                    <input type="radio" name="depositSplitType" id="splitPropNo" value="no" class="toggle__input">
                    <label for="splitPropNo" class="toggle__label">Equal (50/50)</label>
                    <span class="toggle__slider" aria-hidden="true"></span>
                </div>
                <div id="deposit-split-help" class="help-text">Choose whether the initial cash deposit should match your salary ratio or be equal.</div>
            </fieldset>

            <div class="form-row">
                <div class="form-group col">
                    <label class="form-label" for="mortgageInterestRate">Interest Rate (APR %)</label>
                    <div class="input-group">
                        <input type="number" id="mortgageInterestRate" class="input-group__control" value="5" min="0" step="0.1" required aria-describedby="mortgageInterestRate-error" data-cy="mortgageInterestRate-input">
                        <span class="input-group__addon">%</span>
                    </div>
                    <div id="mortgageInterestRate-error" class="alert alert--error" hidden>
                        <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                        <div class="alert__text">Invalid.</div>
                    </div>
                </div>

                <div class="form-group col">
                    <label class="form-label" for="mortgageTerm">Term (Years)</label>
                    <div class="input-group">
                        <input type="number" id="mortgageTerm" class="input-group__control" value="25" min="1" max="50" required aria-describedby="mortgageTerm-help mortgageTerm-error" data-cy="mortgageTerm-input">
                    </div>
                    <div id="mortgageTerm-error" class="alert alert--error" hidden>
                        <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                        <div class="alert__text">Please enter a term between 1 and 50 years.</div>
                    </div>
                </div>
            </div>
            <div id="mortgageTerm-help" class="help-text" style="margin-top: -1rem; margin-bottom: 1.5rem;">The duration of your mortgage repayment plan.</div>

            <!-- 2. Context: Purchase Costs -->
            <fieldset class="form-group">
                <legend class="form-label">Purchase Type</legend>
                <div class="toggle">
                    <input type="radio" name="homeType" id="homeFirst" value="first" checked class="toggle__input">
                    <label for="homeFirst" class="toggle__label">Sole Property</label>
                    <input type="radio" name="homeType" id="homeSecond" value="second" class="toggle__input">
                    <label for="homeSecond" class="toggle__label">Additional Property</label>
                    <span class="toggle__slider" aria-hidden="true"></span>
                </div>
                <div id="home-type-help" class="help-text">Determines the Stamp Duty (SDLT) rate applied to this purchase.</div>
            </fieldset>

            <fieldset class="form-group" id="ftb-container">
                <legend class="form-label">Buyer Status</legend>
                <div class="toggle">
                    <input type="radio" name="buyerStatus" id="buyerStandard" value="standard" checked class="toggle__input">
                    <label for="buyerStandard" class="toggle__label">Standard</label>
                    <input type="radio" name="buyerStatus" id="buyerFTB" value="ftb" class="toggle__input">
                    <label for="buyerFTB" class="toggle__label">First Time Buyer</label>
                    <span class="toggle__slider" aria-hidden="true"></span>
                </div>
                <div id="buyer-status-help" class="help-text">Eligible for First Time Buyer relief in applicable regions.</div>
            </fieldset>

            <div class="purchase-costs-box" aria-live="polite" style="margin-bottom: 2rem; padding: 1.5rem; background: rgba(44, 62, 99, 0.03); border-radius: 0.75rem; border: 1px dashed var(--color-border);">
                <h4 style="margin-top: 0;">Estimated Purchase Costs</h4>
                <div class="form-group">
                    <label class="form-label">Estimated Stamp Duty (SDLT)</label>
                    <div class="input-group">
                        <span class="input-group__addon">£</span>
                        <input type="text" id="sdlt-estimate" class="input-group__control" readonly>
                    </div>
                    <p class="help-text">Standard residential rate estimate.</p>
                </div>
                <div class="form-group">
                    <label class="form-label">Estimated Legal Fees</label>
                    <div class="input-group">
                        <span class="input-group__addon">£</span>
                        <input type="text" id="legal-fees-estimate" class="input-group__control" readonly>
                    </div>
                    <p class="help-text">Includes conveyancing, searches, and bank transfer fees.</p>
                </div>
            </div>

            <!-- 3. Context: Summary -->
            <div class="form-group">
                <label class="form-label" for="displayPropertyPrice">Current Market Value</label>
                <div class="input-group">
                    <span class="input-group__addon">£</span>
                    <input type="text" id="displayPropertyPrice" class="input-group__control" readonly aria-describedby="displayPropertyPrice-help">
                </div>
                <div id="displayPropertyPrice-help" class="help-text">As specified in the property details section.</div>
            </div>

            <div id="equity-mortgage-summary" class="alert alert--info" aria-live="polite">
                <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-info.svg'); mask-image: url('icons/icon-info.svg');" aria-hidden="true"></span>
                <div class="alert__text">
                    Total Equity Required: <span id="totalEquityDisplay" class="fw-bold">£0</span><br>
                    Mortgage Required: <span id="mortgageRequiredDisplay" class="fw-bold">£0</span><br>
                    Est. Monthly Mortgage: <span id="monthlyMortgageDisplay" class="fw-bold">£0</span><br>
                    Total Repayment (inc. Interest): <span id="totalRepaymentDisplay" class="fw-bold">£0</span>
                </div>
            </div>

            <div class="card-grid" id="deposit-share-summary">
                <div class="card card--share-p1">
                    <span class="card__icon" style="-webkit-mask-image: url('icons/icon-user.svg'); mask-image: url('icons/icon-user.svg');" aria-hidden="true"></span>
                    <p class="card__label">Your Deposit Share</p>
                    <p id="equityP1Display" class="card__value" aria-live="polite">£0</p>
                </div>
                <div class="card card--share-p2">
                    <span class="card__icon" style="-webkit-mask-image: url('icons/icon-users.svg'); mask-image: url('icons/icon-users.svg');" aria-hidden="true"></span>
                    <p class="card__label">Partner's Deposit Share</p>
                    <p id="equityP2Display" class="card__value" aria-live="polite">£0</p>
                </div>
            </div>
        </section>

        <section class="screen" id="screen-5" aria-labelledby="heading-utilities" tabindex="-1" hidden>
            <h2 id="heading-utilities">
                <img src="icons/icon-lightning.svg" alt="Utilities Icon">
                Monthly Utilities
            </h2>

            <p>Review baseline household costs.</p>
            <p class="screen-summary">
                We've provided regional estimates for your essential utilities. Adjust these figures to match your actual monthly commitments for more precise results.
            </p>

            <div class="master-toggle">
                <div class="master-toggle-inner">
                    <span class="master-toggle-label">Set All Rules:</span>
                    <div class="toggle" style="margin-bottom: 0; max-width: 18rem;">
                        <input type="radio" name="masterUtilities" id="muRatio" value="yes" onchange="setAllSplitTypes('utilities', 'yes')" class="toggle__input">
                        <label for="muRatio" class="toggle__label">Ratio</label>
                        <input type="radio" name="masterUtilities" id="muEqual" value="no" onchange="setAllSplitTypes('utilities', 'no')" class="toggle__input">
                        <label for="muEqual" class="toggle__label">50/50</label>
                        <span class="toggle__slider"></span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="field-header">
                    <label class="form-label" for="councilTaxCost">Monthly Council Tax (£)</label>
                    <div class="toggle toggle--mini">
                        <input type="radio" name="councilTaxSplitType" id="ctPropYes" value="yes" checked class="toggle__input">
                        <label for="ctPropYes" class="toggle__label">Ratio</label>
                        <input type="radio" name="councilTaxSplitType" id="ctPropNo" value="no" class="toggle__input">
                        <label for="ctPropNo" class="toggle__label">50/50</label>
                        <span class="toggle__slider"></span>
                    </div>
                </div>
                <div class="input-group">
                    <span class="input-group__addon">£</span>
                    <input type="number" id="councilTaxCost" class="input-group__control" required aria-describedby="councilTaxCost-help councilTaxCost-error" data-cy="councilTaxCost-input">
                </div>
                <div id="councilTaxCost-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter the monthly council tax.</div>
                </div>
                <div id="councilTaxCost-help" class="help-text">Estimated based on your selected valuation band.</div>
            </div>

            <div class="form-group">
                <div class="field-header">
                    <label class="form-label" for="energyCost">Monthly Energy Estimate (£)</label>
                    <div class="toggle toggle--mini">
                        <input type="radio" name="energySplitType" id="enPropYes" value="yes" checked class="toggle__input">
                        <label for="enPropYes" class="toggle__label">Ratio</label>
                        <input type="radio" name="energySplitType" id="enPropNo" value="no" class="toggle__input">
                        <label for="enPropNo" class="toggle__label">50/50</label>
                        <span class="toggle__slider"></span>
                    </div>
                </div>
                <div class="input-group">
                    <span class="input-group__addon">£</span>
                    <input type="number" id="energyCost" class="input-group__control" required aria-describedby="energy-explainer energyCost-error" data-cy="energyCost-input">
                </div>
                <div id="energyCost-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter an energy estimate.</div>
                </div>
                <div id="energy-explainer" class="help-text">Estimated gas and electricity usage for this property size and region.</div>
            </div>

            <div class="form-group">
                <div class="field-header">
                    <label class="form-label" for="waterBill">Monthly Water Bill (£)</label>
                    <div class="toggle toggle--mini">
                        <input type="radio" name="waterSplitType" id="wtPropYes" value="yes" checked class="toggle__input">
                        <label for="wtPropYes" class="toggle__label">Ratio</label>
                        <input type="radio" name="waterSplitType" id="wtPropNo" value="no" class="toggle__input">
                        <label for="wtPropNo" class="toggle__label">50/50</label>
                        <span class="toggle__slider"></span>
                    </div>
                </div>
                <div class="input-group">
                    <span class="input-group__addon">£</span>
                    <input type="number" id="waterBill" class="input-group__control" value="30" required aria-describedby="waterBill-help waterBill-error" data-cy="waterBill-input">
                </div>
                <div id="waterBill-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter a water bill amount.</div>
                </div>
                <div id="waterBill-help" class="help-text">Estimated regional average based on bathrooms and postcode.</div>
            </div>

            <div class="form-group">
                <div class="field-header">
                    <label class="form-label" for="broadbandCost">Monthly Broadband & TV (£)</label>
                    <div class="toggle toggle--mini">
                        <input type="radio" name="broadbandSplitType" id="bbPropYes" value="yes" checked class="toggle__input">
                        <label for="bbPropYes" class="toggle__label">Ratio</label>
                        <input type="radio" name="broadbandSplitType" id="bbPropNo" value="no" class="toggle__input">
                        <label for="bbPropNo" class="toggle__label">50/50</label>
                        <span class="toggle__slider"></span>
                    </div>
                </div>
                <div class="input-group">
                    <span class="input-group__addon">£</span>
                    <input type="number" id="broadbandCost" class="input-group__control" placeholder="e.g. 30" aria-describedby="broadband-help broadband-error" data-cy="broadbandCost-input">
                </div>
                <div id="broadband-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter a valid amount.</div>
                </div>
                <div id="broadband-help" class="help-text">Internet, cable, and streaming subscriptions.</div>
            </div>
        </section>

        <section class="screen" id="screen-6" aria-labelledby="heading-committed" tabindex="-1" hidden>
            <h2 id="heading-committed">
                <img src="icons/icon-receipt.svg" alt="Committed Spending Icon">
                Committed Spending
            </h2>
            <p>Add optional shared monthly expenses.</p>
            <p class="screen-summary">
                Defining shared lifestyle costs like food and childcare now ensures full transparency in your joint budget, preventing friction over variable expenses later.
            </p>

            <div class="master-toggle">
                <div class="master-toggle-inner">
                    <span class="master-toggle-label">Set All Rules:</span>
                    <div class="toggle" style="margin-bottom: 0; max-width: 18rem;">
                        <input type="radio" name="masterCommitted" id="mcRatio" value="yes" onchange="setAllSplitTypes('committed', 'yes')" class="toggle__input">
                        <label for="mcRatio" class="toggle__label">Ratio</label>
                        <input type="radio" name="masterCommitted" id="mcEqual" value="no" onchange="setAllSplitTypes('committed', 'no')" class="toggle__input">
                        <label for="mcEqual" class="toggle__label">50/50</label>
                        <span class="toggle__slider"></span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="field-header">
                    <label class="form-label" for="groceriesCost">Monthly Groceries (£)</label>
                    <div class="toggle toggle--mini">
                        <input type="radio" name="groceriesSplitType" id="grPropYes" value="yes" checked class="toggle__input">
                        <label for="grPropYes" class="toggle__label">Ratio</label>
                        <input type="radio" name="groceriesSplitType" id="grPropNo" value="no" class="toggle__input">
                        <label for="grPropNo" class="toggle__label">50/50</label>
                        <span class="toggle__slider"></span>
                    </div>
                </div>
                <div class="input-group">
                    <span class="input-group__addon">£</span>
                    <input type="number" id="groceriesCost" class="input-group__control" placeholder="e.g. 400" aria-describedby="groceries-help groceries-error" data-cy="groceriesCost-input">
                </div>
                <div id="groceries-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter a valid amount.</div>
                </div>
                <div id="groceries-help" class="help-text">Food, household supplies, and shared toiletries.</div>
            </div>

            <div class="form-group">
                <div class="field-header">
                    <label class="form-label" for="childcareCost">Monthly Childcare (£)</label>
                    <div class="toggle toggle--mini">
                        <input type="radio" name="childcareSplitType" id="ccPropYes" value="yes" checked class="toggle__input">
                        <label for="ccPropYes" class="toggle__label">Ratio</label>
                        <input type="radio" name="childcareSplitType" id="ccPropNo" value="no" class="toggle__input">
                        <label for="ccPropNo" class="toggle__label">50/50</label>
                        <span class="toggle__slider"></span>
                    </div>
                </div>
                <div class="input-group">
                    <span class="input-group__addon">£</span>
                    <input type="number" id="childcareCost" class="input-group__control" placeholder="e.g. 200" aria-describedby="childcare-help childcare-error" data-cy="childcareCost-input">
                </div>
                <div id="childcare-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter a valid amount.</div>
                </div>
                <div id="childcare-help" class="help-text">Nursery, childminders, or other care costs.</div>
            </div>

            <div class="form-group">
                <div class="field-header">
                    <label class="form-label" for="insuranceCost">Shared Insurances (£)</label>
                    <div class="toggle toggle--mini">
                        <input type="radio" name="insuranceSplitType" id="isPropYes" value="yes" checked class="toggle__input">
                        <label for="isPropYes" class="toggle__label">Ratio</label>
                        <input type="radio" name="insuranceSplitType" id="isPropNo" value="no" class="toggle__input">
                        <label for="isPropNo" class="toggle__label">50/50</label>
                        <span class="toggle__slider"></span>
                    </div>
                </div>
                <div class="input-group">
                    <span class="input-group__addon">£</span>
                    <input type="number" id="insuranceCost" class="input-group__control" placeholder="e.g. 50" aria-describedby="insurance-help insurance-error" data-cy="insuranceCost-input">
                </div>
                <div id="insurance-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter a valid amount.</div>
                </div>
                <div id="insurance-help" class="help-text">Combined life, health, or pet insurance.</div>
            </div>

            <div class="form-group">
                <div class="field-header">
                    <label class="form-label" for="otherSharedCosts">Other Shared Monthly Costs (£)</label>
                    <div class="toggle toggle--mini">
                        <input type="radio" name="otherSharedSplitType" id="osPropYes" value="yes" checked class="toggle__input">
                        <label for="osPropYes" class="toggle__label">Ratio</label>
                        <input type="radio" name="otherSharedSplitType" id="osPropNo" value="no" class="toggle__input">
                        <label for="osPropNo" class="toggle__label">50/50</label>
                        <span class="toggle__slider"></span>
                    </div>
                </div>
                <div class="input-group">
                    <span class="input-group__addon">£</span>
                    <input type="number" id="otherSharedCosts" class="input-group__control" placeholder="e.g. 100" aria-describedby="other-help other-error" data-cy="otherSharedCosts-input">
                </div>
                <div id="other-error" class="alert alert--error" hidden>
                    <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-error.svg'); mask-image: url('icons/icon-error.svg');" aria-hidden="true"></span>
                    <div class="alert__text">Please enter a valid amount.</div>
                </div>
                <div id="other-help" class="help-text">Gym memberships, streaming services, or car payments.</div>
            </div>
        </section>

        <section class="screen" id="screen-7" aria-labelledby="heading-results" tabindex="-1" hidden>
            <h2 id="heading-results">
                <img src="icons/icon-pie-chart.svg" alt="Detailed Analysis Icon">
                Detailed Analysis
            </h2>

            <p>Review your proportionate household budget below.</p>
            <p class="screen-summary">
                This detailed analysis provides a comprehensive roadmap for your joint contributions. By applying your specific split rules to each line item, we've created a balanced financial plan that respects your individual earning power. Use this breakdown to set up joint account standing orders with absolute confidence.
            </p>

            <div class="result-ratio-bar" id="result-ratio-bar">
                <p class="text-center fw-bold">Your Fair Share Split</p>
                <div class="ratio-bar-display" id="ratio-bar-display" role="img" aria-label="Salary Ratio Chart: 50 percent You and 50 percent Your Partner">
                    <div class="bar-p1" id="bar-p1" aria-hidden="true" data-cy="ratio-bar-p1">50%</div>
                    <div class="bar-p2" id="bar-p2" aria-hidden="true" data-cy="ratio-bar-p2">50%</div>
                </div>
                <p class="sr-only" id="ratio-text-desc">Ratio is 50 percent You and 50 percent Your Partner.</p>
            </div>

            <h3 class="text-center">Your Monthly Shares</h3>
            <div class="card-grid" id="monthly-shares-summary">
                <div class="card card--result card--share-p1" id="result-share-p1">
                    <span class="card__icon" style="-webkit-mask-image: url('icons/icon-user.svg'); mask-image: url('icons/icon-user.svg');" aria-hidden="true"></span>
                    <p class="card__label">You Pay</p>
                    <p class="card__value result-p1" id="result-p1" aria-live="polite" data-cy="result-p1">£0</p>
                </div>
                <div class="card card--result card--share-p2" id="result-share-p2">
                    <span class="card__icon" style="-webkit-mask-image: url('icons/icon-users.svg'); mask-image: url('icons/icon-users.svg');" aria-hidden="true"></span>
                    <p class="card__label">Your Partner Pays</p>
                    <p class="card__value result-p2" id="result-p2" aria-live="polite" data-cy="result-p2">£0</p>
                </div>
            </div>
            <p class="text-center total-bill-row" id="total-bill-row">
                Total Monthly Bill: <span class="fw-bold total-bill-display" id="total-bill-display" aria-live="polite" data-cy="total-bill-display">£0</span>
            </p>
            <div id="result-summary" class="alert alert--info result-summary" aria-live="polite" hidden>
                <span class="alert__icon" style="-webkit-mask-image: url('icons/icon-info.svg'); mask-image: url('icons/icon-info.svg');" aria-hidden="true"></span>
                <div class="alert__text"></div>
            </div>

            <div class="workings">
                <h4 class="workings__title">Calculation Workings</h4>
                <div class="workings__content" id="calculation-workings">
                    <div class="workings__sections">
                        <div class="workings__section">
                            <h5 class="workings__subtitle">1. Combined Annual Income & Ratio</h5>
                            <p><span id="wk-salary-p1">£0</span> + <span id="wk-salary-p2">£0</span> = <strong id="wk-total-salary">£0</strong></p>
                            <ul class="workings__list">
                                <li>You: <strong id="wk-p1-perc">0%</strong> share</li>
                                <li>Your Partner: <strong id="wk-p2-perc">0%</strong> share</li>
                            </ul>
                        </div>

                        <div class="workings__section">
                            <h5 class="workings__subtitle">2. Mortgage & Equity Summary</h5>
                            <p>Property Value: <strong id="wk-property-price">£0</strong></p>
                            <ul class="workings__list">
                                <li>Deposit: <strong id="wk-deposit-perc">0%</strong> (<span id="wk-total-equity">£0</span>) split by <strong id="wk-deposit-split-type">Income Ratio</strong></li>
                                <li>Mortgage Required: <strong id="wk-mortgage-required">£0</strong></li>
                                <li>Terms: <strong id="wk-interest-rate">0%</strong> over <strong id="wk-mortgage-term">0</strong> years</li>
                                <li>Monthly Payment: <strong id="wk-monthly-payment">£0</strong></li>
                                <li>Total Repayment: <strong id="wk-total-repayment">£0</strong> (interest inclusive)</li>
                            </ul>
                        </div>

                        <div class="workings__section">
                            <h5 class="workings__subtitle">3. Calculation Application</h5>
                            <p>Each monthly line item was split using either your <strong>Income Ratio</strong> or <strong>50/50</strong> based on your specific rule choices throughout the form. The mortgage payment is always split by your Income Ratio to ensure long-term fairness.</p>
                        </div>
                    </div>
                </div>
            </div>

            <h3>Full Cost Breakdown</h3>
            <div class="table-scroll-container" id="table-scroll-container">
                <table class="data-table" id="results-table">
                    <thead>
                        <tr>
                            <th scope="col">Expense</th>
                            <th scope="col">Total</th>
                            <th scope="col">You</th>
                            <th scope="col">Your Partner</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">Mortgage</th>
                            <td id="bd-mortgage-total" aria-live="polite">£0</td>
                            <td id="bd-mortgage-p1" aria-live="polite">£0</td>
                            <td id="bd-mortgage-p2" aria-live="polite">£0</td>
                        </tr>
                        <tr>
                            <th scope="row">Council Tax</th>
                            <td id="bd-tax-total" aria-live="polite">£0</td>
                            <td id="bd-tax-p1" aria-live="polite">£0</td>
                            <td id="bd-tax-p2" aria-live="polite">£0</td>
                        </tr>
                        <tr>
                            <th scope="row">Energy</th>
                            <td id="bd-energy-total" aria-live="polite">£0</td>
                            <td id="bd-energy-p1" aria-live="polite">£0</td>
                            <td id="bd-energy-p2" aria-live="polite">£0</td>
                        </tr>
                        <tr>
                            <th scope="row">Water</th>
                            <td id="bd-water-total" aria-live="polite">£0</td>
                            <td id="bd-water-p1" aria-live="polite">£0</td>
                            <td id="bd-water-p2" aria-live="polite">£0</td>
                        </tr>
                        <tr>
                            <th scope="row">Broadband & TV</th>
                            <td id="bd-broadband-total" aria-live="polite">£0</td>
                            <td id="bd-broadband-p1" aria-live="polite">£0</td>
                            <td id="bd-broadband-p2" aria-live="polite">£0</td>
                        </tr>
                        <tr>
                            <th scope="row">Groceries</th>
                            <td id="bd-groceries-total" aria-live="polite">£0</td>
                            <td id="bd-groceries-p1" aria-live="polite">£0</td>
                            <td id="bd-groceries-p2" aria-live="polite">£0</td>
                        </tr>
                        <tr>
                            <th scope="row">Committed Spending</th>
                            <td id="bd-committed-total" aria-live="polite">£0</td>
                            <td id="bd-committed-p1" aria-live="polite">£0</td>
                            <td id="bd-committed-p2" aria-live="polite">£0</td>
                        </tr>
                        <tr class="table-total-row" id="table-total-row">
                            <th scope="row">Total</th>
                            <td id="bd-total-total" aria-live="polite">£0</td>
                            <td id="bd-total-p1" aria-live="polite">£0</td>
                            <td id="bd-total-p2" aria-live="polite">£0</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <p class="help-text breakdown-summary" id="breakdown-summary" style="margin-top: 1rem; border-top: 1px solid var(--color-border); padding-top: 1rem;"></p>

            <div class="nav nav--vertical">
                <button type="button" id="downloadCSVBtn" class="btn btn-success btn-block" onclick="downloadCSV()">
                    <span class="icon-btn" style="-webkit-mask-image: url('icons/icon-download.svg'); mask-image: url('icons/icon-download.svg'); width: 1.25rem; height: 1.25rem; vertical-align: middle; margin-right: 0.5rem; display: inline-block;" aria-hidden="true"></span>
                    Download results as CSV
                </button>
            </div>
        </section>

        <div class="nav">
            <button id="back-button" class="btn btn-secondary nav__button" data-cy="back-button">Back</button>
            <button id="next-button" class="btn btn-primary nav__button" data-cy="next-button">Next</button>
        </div>
    </div>
</main>

<footer>
    Vibe coded by Ash Davies (DrizzlyOwl) and Gemini | <a href="README.md" target="_blank" style="color: inherit; text-decoration: underline;">Project Info</a>
</footer>

<div class="progress" id="progress-container">
    <div class="progress__track" id="progress-track">
        <span class="progress__text" id="progress-text-alt" aria-live="polite">Step 1 of 7: Welcome</span>
        <div class="progress__bar" id="app-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Application Progress" aria-valuetext="Step 1 of 7: Welcome"></div>
    </div>
</div>

<link rel="stylesheet" href="style.css?v=1771261001">
<script src="app.js?v=1771261001"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const efficiencyTip = document.getElementById('efficiency-tip');
        if (efficiencyTip) {
            const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
            if (isTouchDevice) {
                efficiencyTip.setAttribute('hidden', '');
            } else {
                efficiencyTip.removeAttribute('hidden');
            }
        }
    });
</script>

<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js')
                .then(reg => console.log('Service Worker: Registered (Scope: ' + reg.scope + ')'))
                .catch(err => console.log('Service Worker: Registration Failed', err));
        });
    }
</script>

</body>
</html>
